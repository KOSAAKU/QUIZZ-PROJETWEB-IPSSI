<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
</head>
<body>
    <h1>Dashboard Admin</h1>
    
    <nav>
        <a href="/">Accueil</a> | 
        <a href="/logout.html">Déconnexion</a>
    </nav>
    
    <hr>
    
    <h2>Gestion des Utilisateurs</h2>
    
    <h3>Ajouter un utilisateur</h3>
    <form method="POST" action="/admin/users/add">
        <label for="name">Nom :</label>
        <input type="text" id="name" name="name" required>
        <br><br>
        
        <label for="email">Email :</label>
        <input type="email" id="email" name="email" required>
        <br><br>
        
        <label for="password">Mot de passe :</label>
        <input type="password" id="password" name="password" required>
        <br><br>
        
        <label for="role">Rôle :</label>
        <select id="role" name="role" required>
            <option value="user">Utilisateur</option>
            <option value="admin">Admin</option>
        </select>
        <br><br>
        
        <button type="submit">Ajouter</button>
    </form>
    
    <h3>Liste des utilisateurs</h3>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Email</th>
                <th>Rôle</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <hr>
    
    <h2>Gestion des Quiz</h2>
    
    <h3>Ajouter un quiz</h3>
    <form method="POST" action="/admin/quizzes/add">
        <label for="title">Titre :</label>
        <input type="text" id="title" name="title" required>
        <br><br>
        
        <label for="category">Catégorie :</label>
        <select id="category" name="category" required>
            <option value="">-- Sélectionner --</option>
            <option value="histoire">Histoire</option>
            <option value="geographie">Géographie</option>
            <option value="sciences">Sciences</option>
            <option value="litterature">Littérature</option>
            <option value="autre">Autre</option>
        </select>
        <br><br>
        
        <label for="description">Description :</label>
        <textarea id="description" name="description" rows="4" cols="50"></textarea>
        <br><br>
        
        <button type="submit">Ajouter</button>
    </form>
    
    <h3>Liste des quiz</h3>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Catégorie</th>
                <th>Auteur</th>
                <th>Questions</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <hr>
    
    <h2>Statistiques</h2>
    <ul>
        <li>Total d'utilisateurs : 0</li>
        <li>Total de quiz : 0</li>
        <li>Total de questions : 0</li>
    </ul>
    
    <hr>
    
    <footer>
        <p>Dashboard Admin - Quizzeo &copy; 2025</p>
    </footer>
    <script>
        let users = [];
        fetch('/users', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
            })
            .then(response => {
                if (response.status === 401) {
                    alert('Session expirée, veuillez vous reconnecter');
                    window.location.href = '/login.html';
                    return;
                }
                return response.json();
            })
            .then(data => {
                if (!data) return;

                users = data.users;
                const tbody = document.querySelector('table tbody');
                users.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.role}</td>
                        <td>
                            <form method="POST" action="/admin/users/delete" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                <input type="hidden" name="id" value="${user.id}">
                                <button type="submit">Supprimer</button>
                            </form>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des utilisateurs:', error);
                alert('Erreur lors de la récupération des utilisateurs');
            });
    </script>
</body>
</html>