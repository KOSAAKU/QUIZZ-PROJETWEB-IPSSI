<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Entreprise - Quizzeo</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body class="bg-gray-100">

    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="/" class="text-2xl font-bold text-gray-800"> <img src="/assets/img/img1.png" alt=""> </a>
            <div>
                <a href="/logout.html" class="px-4 py-2 leading-none rounded-lg btn-secondary text-white">Déconnexion</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard Entreprise</h1>
            <!-- Section Création de Quiz -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Création de Quiz</h2>
                <a href="/quizz/create" class="btn-primary w-full py-2 rounded-lg text-center inline-block">Créer un nouveau quiz</a>
                 <div class="overflow-x-auto mt-4">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="bg-gray-200">
                                <th class="p-3">#</th>
                                <th class="p-3">Quizz</th>
                                <th class="p-3">Participants</th>
                                <th class="p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Quiz rows here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <br />

             <!-- Section Statistiques -->
            <div class="bg-white rounded-lg shadow-lg p-6 lg:col-span-2">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Statistiques</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <p class="text-3xl font-bold">0</p>
                        <p class="text-gray-600">Quiz Créés</p>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded-lg">
                        <p class="text-3xl font-bold">0</p>
                        <p class="text-gray-600">Quiz Complétés</p>
                    </div>
                     <div class="bg-purple-100 p-4 rounded-lg">
                        <p class="text-3xl font-bold">-</p>
                        <p class="text-gray-600">Score Moyen</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white mt-16 py-6">
        <div class="container mx-auto px-6 text-center text-gray-600">
            <p>&copy; 2025 Quizzeo - Tous droits réservés</p>
        </div>
        <script>
            // Récupère et affiche la liste des quizzs; gestion des erreurs ajoutée
            document.addEventListener('DOMContentLoaded', function() {
                fetch('/quizzes')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erreur réseau: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(payload => {
                        const quizzes = payload.quizzes || [];
                        const tbody = document.querySelector('table tbody');
                        tbody.innerHTML = '';

                        if (quizzes.length === 0) {
                            const emptyRow = document.createElement('tr');
                            emptyRow.innerHTML = `<td class="p-3" colspan="4">Aucun quizz trouvé.</td>`;
                            tbody.appendChild(emptyRow);
                            return;
                        }

                        quizzes.forEach((quiz, index) => {
                            const row = document.createElement('tr');
                            const title = quiz.name || quiz.title || 'Sans titre';
                            const participants = quiz.participants ?? '-';
                            row.innerHTML = `
                                <td class="p-3">${index + 1}</td>
                                <td class="p-3">${title}</td>
                                <td class="p-3">${participants}</td>
                                <td class="p-3">
                                    <a href="/quizz/${quiz.id}/edit" class="text-blue-600 hover:underline mr-4">Éditer</a>
                                    <a href="/quizz/${quiz.id}/delete" class="text-red-600 hover:underline">Supprimer</a>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching quizzes:', error);
                        const tbody = document.querySelector('table tbody');
                        tbody.innerHTML = `<tr><td class="p-3" colspan="4">Erreur lors du chargement des quizzs: ${error.message}</td></tr>`;
                    });
            });
        </script>
    </footer>
</body>
</html>