<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Répondre au Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-10">

<div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-10 border-t-8 border-primary">
    <h1 class="text-4xl font-bold text-center mb-8 text-gray-700" id="quiz-title">Quiz</h1>
    <form id="quiz-form" class="space-y-8">
        <div id="questions-container" class="space-y-6"></div>
        <div class="flex justify-center mt-10">
            <button type="submit"
                    class="py-3 px-8 rounded-xl font-semibold text-xl shadow-lg transition btn-primary bg-green-500 hover:bg-green-600 text-white">
                Valider mes réponses
            </button>
        </div>
    </form>
</div>

<script>
const quizId = 1; // ID du quiz à récupérer
let quizData = null;

async function loadQuiz() {
    try {
        const res = await fetch(`http://localhost:3000/api/quizzes/${quizId}`);
        if (!res.ok) throw new Error("Erreur lors du chargement du quiz");

        const data = await res.json();
        quizData = data;

        document.getElementById("quiz-title").textContent = quizData.name;

        const container = document.getElementById("questions-container");
        container.innerHTML = "";

        quizData.questions.forEach((q, index) => {
            let html = `<div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
                            <h3 class="text-xl font-semibold mb-4">${index + 1}. ${q.question}</h3>`;
            if (q.type === "libre") {
                html += `<input type="text" name="q-${index}" class="w-full p-3 border rounded-xl" placeholder="Votre réponse">`;
            } else if (q.type === "qcm") {
                html += `<div class="space-y-2">`;
                q.choices.forEach((choice, i) => {
                    html += `<label class="flex items-center gap-2">
                                <input type="radio" name="q-${index}" value="${choice}">
                                <span>${choice}</span>
                             </label>`;
                });
                html += `</div>`;
            }
            html += `</div>`;
            container.insertAdjacentHTML("beforeend", html);
        });

    } catch (err) {
        console.error(err);
        alert("Impossible de charger le quiz.");
    }
}

document.getElementById("quiz-form").addEventListener("submit", function(event) {
    event.preventDefault();

    const responses = quizData.questions.map((q, index) => {
        const input = document.querySelector(`[name="q-${index}"]`);
        if (!input) return null;

        if (q.type === "libre") return { question: q.question, answer: input.value };
        if (q.type === "qcm") {
            const checked = document.querySelector(`[name="q-${index}"]:checked`);
            return { question: q.question, answer: checked ? checked.value : null };
        }
    });

    console.log("Réponses de l'utilisateur :", responses);

    // Ici tu peux envoyer les réponses au serveur si tu veux
    // fetch("https://localhost:3000/quizzes/1/answers", { method: "POST", body: JSON.stringify(responses) ... })
});

loadQuiz();
</script>

</body>
</html>
